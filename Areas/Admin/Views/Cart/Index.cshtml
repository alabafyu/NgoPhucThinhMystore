


@model NgoPhucThinhMystore.Models.ViewModel.Cart

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .shoppingcart {
        background-color: ghostwhite;
    }

    .cart-section {
        background-color: white;
        border: 1px groove #ffffff;
        border-radius: 10px;
        padding: 10px 10px;
        margin: 10px;
    }

    .cart-button {
        margin-top: 5px;
        margin-left: 5px;
        border: 1px solid #484848;
    }

    .shoppingcart hr {
        border: 1px solid silver;
    }
</style>

<script language="javascript">
    function sendUpdate(id, quantity) {
        if (quantity < 1) return;

        var form = document.createElement('form');
        form.action = '@Url.Action("UpdateQuantity", "Cart")';
        form.method = 'post';

        var idInput = document.createElement('input');
        idInput.type = 'hidden';
        idInput.name = 'id';
        idInput.value = id;

        var quantityInput = document.createElement('input');
        quantityInput.type = 'hidden';
        quantityInput.name = 'quantity';
        quantityInput.value = quantity;

        form.appendChild(idInput);
        form.appendChild(quantityInput);
        document.body.appendChild(form);
        form.submit();
    }
</script>

@if (Model != null)
{
    // Giỏ hàng chưa có sản phẩm
    if (Model.Items == null)
    {
        // ... (Nội dung hiển thị giỏ hàng trống)
    }

    <div class="row">
        <div class="col-md-9 cart-section">
            @foreach (var categoryGroup in Model.GroupedItems)
            {
                <div class="categoryGroup">
                    <h4 class="category-title">@categoryGroup.Key</h4>
                    <table class="table cart-section">
                        <thead>
                            <tr>
                                <th scope="col">Sản phẩm</th>
                                <th scope="col">Giá thành</th>
                                <th scope="col">Số lượng</th>
                                <th scope="col">Thành tiền</th>
                                <th scope="col"></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in categoryGroup)
                            {
                                <tr>
                                    <td>
                                        <img src="@item.ProductImage" style="max-height: 50px; max-width: 50px;" />
                                        <span>@item.ProductName</span>
                                    </td>
                                    <td>@item.UnitPrice.ToString("N0")</td>
                                    <td>
                                        @using (Html.BeginForm("UpdateQuantity", "Cart", FormMethod.Post))
                                        {
                                            <input type="number" name="quantity" value="@item.Quantity" onchange="sendUpdate(@item.ProductID, this.value)" style="width: 50px;" />
                                            <input type="hidden" name="id" value="@item.ProductID" />
                                            <button type="button" style="display:none;" onclick="sendUpdate(@item.ProductID, @item.Quantity)">Update</button>
                                        }
                                    </td>
                                    <td>@item.TotalPrice.ToString("N0")</td>
                                    <td>
                                        @Html.ActionLink("Xóa", "RemoveFromCart", "Cart", new { id = item.ProductID }, new { @class = "btn btn-danger btn-sm" })
                                        <img src="@Url.Content("~/Images/remove.png")" style="max-height: 30px; max-width: 30px;" />
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>

        <div class="col-md-3 cart-section">
            @Html.Partial("_PVSimilarProduct", Model)
        </div>
    </div>
}